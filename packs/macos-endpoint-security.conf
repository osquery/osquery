{
  "platform": "darwin",
  "version": "1.0.0",
  "description": "Useful queries leveraging macOS EndpointSecurity monitoring",
  "queries": {
    "es_process_creation": {
      "query": "SELECT pid, path, username, cmdline, time, cdhash, signing_id, team_id, platform_binary, codesigning_flags FROM es_process_events WHERE event_type = 'exec';",
      "interval": 300,
      "description": "Monitor process creation events via EndpointSecurity",
      "platform": "darwin"
    },
    "es_process_lifecycle": {
      "query": "SELECT event_type, pid, path, username, time FROM es_process_events WHERE event_type IN ('exec', 'fork', 'exit') AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor process lifecycle events (creation, forking, termination)",
      "platform": "darwin"
    },
    "es_authentication_events": {
      "query": "SELECT * FROM es_security_events WHERE event_type IN ('authentication', 'openssh_login', 'su', 'sudo') AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor authentication attempts (requires enable_es_authentication_events=true)",
      "platform": "darwin"
    },
    "es_privilege_escalation": {
      "query": "SELECT * FROM es_security_events WHERE event_type IN ('setuid', 'seteuid', 'setreuid') AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor privilege escalation via uid changes (requires enable_es_auth_events=true)",
      "platform": "darwin"
    },
    "es_remote_thread_creation": {
      "query": "SELECT * FROM es_security_events WHERE event_type = 'remote_thread_create';",
      "interval": 300,
      "description": "Monitor remote thread creation (potential code injection, requires enable_es_remote_thread_events=true)",
      "platform": "darwin"
    },
    "es_mount_events": {
      "query": "SELECT * FROM es_security_events WHERE event_type IN ('mount', 'unmount') AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor filesystem mount and unmount events (requires enable_es_file_events=true)",
      "platform": "darwin"
    },
    "es_screensharing_connections": {
      "query": "SELECT * FROM es_security_events WHERE event_type LIKE 'screensharing_%' AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor screen sharing connection and disconnection events (requires enable_es_screensharing_events=true)",
      "platform": "darwin"
    },
    "es_ssh_activity": {
      "query": "SELECT * FROM es_security_events WHERE event_type IN ('openssh_login', 'openssh_logout') AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor SSH login and logout activity (requires enable_es_authentication_events=true)",
      "platform": "darwin"
    },
    "es_profile_installation": {
      "query": "SELECT * FROM es_security_events WHERE event_type IN ('profile_add', 'profile_remove') AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor profile installation and removal (requires enable_es_profile_events=true)",
      "platform": "darwin"
    },
    "es_xpc_connections": {
      "query": "SELECT * FROM es_security_events WHERE event_type = 'xpc_connect' AND time > (SELECT unix_time - 3600 FROM time);",
      "interval": 300,
      "description": "Monitor XPC service connections (requires enable_es_xpc_events=true)",
      "platform": "darwin"
    },
    "es_suspicious_security_events": {
      "query": "SELECT * FROM es_security_events WHERE (event_type = 'remote_thread_create') OR (event_type IN ('setuid', 'seteuid') AND username \!= 'root');",
      "interval": 300,
      "description": "Monitor suspicious security events like remote thread creation and unauthorized uid changes",
      "platform": "darwin"
    }
  }
}
